{"version":3,"file":"rollup-plugin-graphql.es.js","sources":["../src/toESModules.js","../src/index.js"],"sourcesContent":["import { EOL } from 'os';\n\nexport default function (source) {\n  if (typeof source !== \"string\") {\n    return source;\n  }\n\n  return replaceRequires(replaceModuleExports(source));\n}\n\nfunction replaceModuleExports(source) {\n  return source.replace('module.exports = doc', 'export default doc');\n}\n\nfunction replaceRequires(source) {\n  const imports = {};\n  let index = 0;\n  \n  // replace a require statement with a variable\n  source = source.replace(/require\\(([^)]+)\\)/ig, (match, path) => {\n    path = path.replace(/[\\\"\\']+/g, '');\n    \n    if (!imports[path]) {\n      imports[path] = `frgmt${++index}`;\n    }\n    \n    return imports[path];\n  });\n\n  // prepare import statements\n  const importsOutput = Object.keys(imports)\n    .map((path) => `import ${imports[path]} from \"${path}\";`)\n    .join(EOL);\n\n  return importsOutput + EOL + source;\n}\n","import { createFilter } from 'rollup-pluginutils';\nimport loader from 'graphql-tag/loader';\n\nimport toESModules from './toESModules';\n\nexport default function graphql (options = {}) {\n\t// path filter\n\tconst filter = createFilter(options.include, options.exclude);\n\t// only .graphql and .gql files\n\tconst filterExt = /\\.(graphql|gql)$/i;\n\n\treturn {\n\t\tname: 'graphql',\n\t\ttransform (source, id) {\n\t\t\tif (!filter(id)) return null;\n\t\t\tif (!filterExt.test(id)) return null;\n\n\t\t\t// XXX: this.cachable() in graphql-tag/loader\n\t\t\tconst code = toESModules(loader.call({cacheable () {}}, source));\n\n\t\t\treturn { code };\n\t\t}\n\t};\n}\n"],"names":["const","let"],"mappings":";;;;AAEA,kBAAe,UAAU,MAAM,EAAE;EAC/B,IAAI,OAAO,MAAM,KAAK,QAAQ,EAAE;IAC9B,OAAO,MAAM,CAAC;GACf;;EAED,OAAO,eAAe,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC;CACtD,CAAA;;AAED,SAAS,oBAAoB,CAAC,MAAM,EAAE;EACpC,OAAO,MAAM,CAAC,OAAO,CAAC,sBAAsB,EAAE,oBAAoB,CAAC,CAAC;CACrE;;AAED,SAAS,eAAe,CAAC,MAAM,EAAE;EAC/BA,IAAM,OAAO,GAAG,EAAE,CAAC;EACnBC,IAAI,KAAK,GAAG,CAAC,CAAC;;;EAGd,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,sBAAsB,EAAE,UAAC,KAAK,EAAE,IAAI,EAAE;IAC5D,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;;IAEpC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;MAClB,OAAO,CAAC,IAAI,CAAC,GAAG,OAAM,IAAE,EAAE,KAAK,CAAA,CAAG;KACnC;;IAED,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC;GACtB,CAAC,CAAC;;;EAGHD,IAAM,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;KACvC,GAAG,CAAC,UAAC,IAAI,EAAE,UAAG,SAAQ,IAAE,OAAO,CAAC,IAAI,CAAC,CAAA,aAAQ,GAAE,IAAI,QAAG,IAAC,CAAC;KACxD,IAAI,CAAC,GAAG,CAAC,CAAC;;EAEb,OAAO,aAAa,GAAG,GAAG,GAAG,MAAM,CAAC;CACrC;;AC9Bc,SAAS,OAAO,EAAE,OAAY,EAAE;kCAAP,GAAG,EAAE;;;CAE5CA,IAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;;CAE9DA,IAAM,SAAS,GAAG,mBAAmB,CAAC;;CAEtC,OAAO;EACN,IAAI,EAAE,SAAS;EACf,SAAS,oBAAA,EAAE,MAAM,EAAE,EAAE,EAAE;GACtB,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,EAAA,OAAO,IAAI,CAAC,EAAA;GAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAA,OAAO,IAAI,CAAC,EAAA;;;GAGrCA,IAAM,IAAI,GAAG,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,oBAAA,IAAI,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;;GAEjE,OAAO,EAAE,MAAA,IAAI,EAAE,CAAC;GAChB;EACD,CAAC;CACF;;"}